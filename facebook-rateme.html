<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://opengraphprotocol.org/schema/" xmlns:fb="http://www.facebook.com/2008/fbml" xml:lang="en-us" lang="en-us">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title>RODCAST</title>

	<meta name="viewport" content="width=device-width">
	  
	<link href="css/normalize.css" rel="stylesheet" type="text/css" />
	<link href="css/style.css" rel="stylesheet" type="text/css" />
</head>
<body>

  <section id="container">
	<nav>
	  <h2>Albums</h2>
	  <ul id="albums"></ul>
	</nav>
	
	<article>
	  <h2>Photos</h2>
	  <div id="photos">There's photo.</div>
	</article>
  </section>
  
  <div id="fb-root"></div>
  
  <script src="https://connect.facebook.net/en_US/all.js"></script>
  <script src="http://code.jquery.com/jquery-1.8.1.min.js"></script>
  <script>
    $(function(){
		var albumsList = [],
			photosList = [];

		FB.init({
		  appId: '420083701382995',
		  status: true,
		  cookie: true,
		  xfbml: true,
		  oauth: true
		});

		function authFacebookAccount() {
			FB.login(function(response) {
			  if (response.authResponse) {
				getMyAlbums();
			  } else {
				alert('User cancelled login!');
			  }
			}, {scope: 'email,user_photos,user_likes,friends_likes'});
		}

		function getMyAlbums() {
			FB.api('/me/albums', function(response) {
				$.each(response.data, function(i, albums) {
					albumsList.push('<li><a href="#" class="album" data-album="' + albums.id + '">' + albums.name + '</a></li>');
				});

				showAlbums();
				setEventAlbums();
			});
		}

		function getPhotos(id) {
			FB.api('/' + id + '/photos', function(response) {
				$.each(response.data, function(i, photo) {
					$.each(photo.images, function(i, images) {
						if (~images.source.indexOf('320x320')) {
							photosList.push('<a href="' + images.source + '" data-likes="' + (photo.likes.data.length || 0) + '" class="photo"><img src=' + images.source + '></a>');
						}
					});
				});

				showPhotos();
				setEventPhotos();
			});
		}

		function showAlbums() {
			$('#albums').html('').append(albumsList.join(""));
			
			albumsList = [];
		}

		function showPhotos() {
			$('#photos').html('').append(photosList.join(""));
			
			photosList = [];
		}

		function setEventAlbums() {
			$('.album').on('click', function(event) {
				getPhotos($(this).data('album'));
	
				event.preventDefault();
			});
		}

		function setEventPhotos() {
			$('.photo').bind('click', function(event) {
				FB.ui({
				  method: 'apprequests',
				  title: 'RODCAST Rating. I\'m better than you.',
				  message: 'I did ' + $(this).data('likes') + ' likes in that picutre and you? See and be happy!'
				}, function(response) {
					if (!response) {
						alert('Error!');
					} else {
						alert(response);
					}
				});
	
				event.preventDefault();
			});
		}

		authFacebookAccount();
    });
  </script>

  
</body>
</html>